<!DOCTYPE html> 
<html>
<head>
	<title>Monster</title>

	<link rel="stylesheet" href="jquery.mobile-1.4.2.min.css" />
	<script src="jquery-1.9.1.min.js"></script>
	<script src="jquery.mobile-1.4.2.min.js"></script>
	<link rel="stylesheet" href="theme-classic.css" />
</head>

<body>

<div id="page1" data-role="page">
  <header data-role="header" data-theme="b"><h6>Welcome</h6></header>
  <div data-role="content" class="content">
        <form method="post" id="loginform">
            <img src="images/slk.jpg" style="width: 100%;" />
            <a href="register.html" data-role="button" data-theme="e">Register</a>
            <a href="#" data-role="button" data-theme="e" onclick="getPhoto()">Login</a>
        </form>
  </div>
  <footer data-role="footer" data-theme="b"><h6>&copy; 2014 SunGard</h6></footer>
</div>
<div data-role="page" id="page2">
	<div data-role="header" data-theme="b"><h6>Login Successfully!</h6></div>
	<div data-role="main" class="ui-content">
		<img style="display:none" id="image" src="" />
		name:  <span id="page2-span-name"></span><br />
		email: <span id="page2-span-email"></span>
		<a href="#page1" data-role="button" data-theme="e">Logoff</a>
	</div>
	<div data-role="footer" data-theme="b"><h6>&copy; 2014 SunGard</h6></div >
</div>

<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript">
function getPhoto() {
	navigator.camera.getPicture(onSuccess, onFail, { quality: 50,
		destinationType: navigator.camera.DestinationType.FILE_URI,
		sourceType: navigator.camera.PictureSourceType.CAMERA,
		direction: navigator.camera.Direction.FRONT});
}

function onSuccess(imageURI) {
	var win = function(r) {
		var json = JSON.parse(r.response);
		if (json.status == 1) {
			$.mobile.navigate('#page2');
			document.getElementById("page2-span-name").innerText = json.name;
			document.getElementById("page2-span-email").innerText = json.email;
			var image = document.getElementById('image');
			image.style.display = 'block';
			image.src = "data:image/jpeg;base64," + json.imageString;
		} else {
			alert('Authentication failed, please try again');
		}
	}

	var fail = function(error) {
		alert("An error has occurred: Code = " + error.code);
	}

	var options = new FileUploadOptions();
	options.fileKey="file";
	options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
	options.mimeType="image/jpeg";

	var ft = new FileTransfer();
	ft.upload(imageURI, encodeURI("http://10.253.125.88:8084/face/rest/mobile/login"), win, fail, options);
}

function onFail(message) {
	alert('An error has occurred: ' + message);
}
</script>
</body>

</html>